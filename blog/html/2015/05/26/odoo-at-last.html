<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Blog mostly about software.">
        <meta name="viewport" content="width=device-width">
        <title>Odoo at last! &mdash; Manuel on Software - Reloaded</title>
            <link rel="stylesheet" href="../../../_static/normalize.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/sphinx.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/main.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/mva.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="../../../_static/font-awesome.min.css" type="text/css">
        <!-- Load modernizr and JQuery -->
<script src="../../../_static/vendor/modernizr-2.6.2.min.js"></script>
<script src="../../../_static/vendor/jquery-1.8.2.min.js"></script>
<script src="../../../_static/plugins.js"></script>
<script src="../../../_static/main.js"></script>
<link rel="next" title="Memento: microservices" href="../../04/08/rememoring-microservices.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="../../../_static/underscore.js"></script><script type="text/javascript" src="../../../_static/doctools.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            // Scroll to content if on small screen
            if (screen.width < 480)
            {
                $(document).scrollTop(document.getElementsByTagName("article")[0].offsetTop - 44);
            }
        });
    </script>
    <!-- link rel='stylesheet' id='open-sans-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&#038;subset=latin%2Clatin-ext&#038;ver=4.0-alpha' type='text/css' media='all' / -->
    <!-- link rel='stylesheet' id='syntax-merriweather-css'  href='http://fonts.googleapis.com/css?family=Merriweather%3A400%2C300%2C300italic%2C400italic%2C700%2C700italic&#038;ver=4.0-alpha' type='text/css' media='all' / --></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><header role="banner">
            <hgroup>
              <h1><a href="../../../index.html">Manuel on Software - Reloaded</a></h1></hgroup>
          </header>
      <!--    <h1 id="toggle-nav" class="menu-toggle">
      <span class="screen-reader-text">Menu</span></h1>
    <nav role="navigation">
      <ul>
        <li class="main-nav">
          <a href="../../../index.html">Home</a>
        </li>
        <li class="main-nav">
          <a href="../../../pages/about-this.html">About this</a>
        </li>
        </ul>
    </nav> --><div class="main-container" role="main"><div class="main wrapper body clearfix"><article><div class="section" id="odoo-at-last">
<h1>Odoo at last!</h1>
<p>After several months, we have finally moved from OpenERP to Odoo.  It took
several rounds of testing, finding bugs and incompatibilities in our own
modules and fixing them.</p>
<div class="section" id="a-summary-of-the-process">
<h2>A summary of the process</h2>
<p>The <a class="reference external" href="https://github.com/OpenUpgrade/OpenUpgrade">OpenUpgrade</a> project proved to be very complete for us &#8211;it had almost
everything we needed:</p>
<ul class="simple">
<li>The Accounting and Project modules were done.</li>
<li>The CRM module was not yet integrated into the mainstream repository but a
<a class="reference external" href="https://github.com/StefanRijnhart/OpenUpgrade">fork by Stefan Rijnhart</a> had a branch that proved very
complete for our needs.</li>
</ul>
<p>We began by merging Stefan&#8217;s branch into our own clone of the repository.  We
came into a small issue and <a class="reference external" href="https://github.com/mvaled/OpenUpgrade/commit/57cd439">fixed it</a>.  Afterwards, some of our
recurrent events were missing the timezone and the migration failed.  For that
we created the branch <a class="reference external" href="https://github.com/mvaled/OpenUpgrade/tree/8.0-valid-rrules">8.0-valid-rrules</a> and it did the job after a couple of
tweeks.</p>
<p>The branch we actually used for the migration is <a class="reference external" href="https://github.com/mvaled/OpenUpgrade/tree/merchise-8.0">merchise-8.0</a>.  It includes
several commits we had to make for our customs addons to work.  Those commits
are probably too local to be merged back into the upstream.  However, we have
published them should anyone finds them useful.</p>
</div>
<div class="section" id="the-menu-decomposition">
<h2>The menu decomposition</h2>
<p>The biggest issue we&#8217;ve encountered so far is that after several hours of
operation all the menus stopped working: You clicked the &#8220;Leads&#8221; menu item and
you got, say, the list of Many2Many fields. (???!!!)</p>
<p>A first inspection showed that all menu items in the HTML were <em>somehow</em>
related to the same action id.  Quickly, we truncated the <span class="docutils literal"><span class="pre">ir_ui_menu</span></span> table
and its associated <span class="docutils literal"><span class="pre">ir_model_data</span></span> rows, upgraded the DB and all menus came
to life once more.</p>
<p>The day after, the same problem happened.  Deeper inspection of both the code
and the DB showed the problem lied in the <span class="docutils literal"><span class="pre">ir_values</span></span> table.  That table
relates menu items with actions.  The rows containing this relation showed
nonsense: almost all the menu items were related to &#8220;<span class="docutils literal"><span class="pre">res_partner,20</span></span>&#8221;.  And
in the UI this was interpreted to be pointing to the action with id 20.</p>
<p>Comparing the table before and after the upgrade showed no problem there.  So
this issue had appeared after the migration itself.</p>
<p>Our previous method of truncating <span class="docutils literal"><span class="pre">ir_ui_menu</span></span> didn&#8217;t fix this issue cause
the <span class="docutils literal"><span class="pre">ir_values</span></span> rows remained there crippling over and over again.  Besides,
truncating <span class="docutils literal"><span class="pre">ir_ui_menu</span></span> had the unintentional, bad side-effect of removing
every Mail list in our DB.</p>
<p>We&#8217;re still on the track about how the <span class="docutils literal"><span class="pre">ir.values</span></span> were messed up in the
first place.</p>
</div>
<div class="section" id="the-magical-6-tabs">
<h2>The magical 6 tabs</h2>
<p>Our users started to report slowness after a couple of hours of working.
First, we noticed that the call to <span class="docutils literal"><span class="pre">load_needaction</span></span> was taking too long and
find out this call asked for too much it did not need, we <a class="reference external" href="https://github.com/odoo/odoo/pull/6772">provided a fix</a> and some loose benchmarks.  Though this patch needs
to be completed, the slowness was solved... for a moment.</p>
<p>Some users kept reporting the Odoo interface was freezing all the time, even
inviting them to go out and drink a cup of coffee...  But other users were
happy about it after the patch.  Closer inspection showed many of the AJAX
calls were blocking waiting for a socket to be available.</p>
<p>It turned out these users had created a habit of opening several tabs when
they worked with OpenERP.  They kept this kind of behavior, but a couple of
facts worked against them:</p>
<ul>
<li><p class="first">We have installed the Odoo chat.  Many of our users are geographically
spread, the chat provided an instant and cheaper communication path.</p>
<p>This feature was, by far, one the reason we moved to Odoo in the first
place.</p>
<p>On technical side, the chat works by long polling the server.  In our server
this connection stays open for about 50s before being dropped (only to be
reestablished a moment later).</p>
<p>This means: a tab has always at least a connection open to the server.</p>
</li>
<li><p class="first">As explained by Ilya Grigorik in <a class="reference external" href="http://www.aosabook.org/en/posa/high-performance-networking-in-chrome.html">High Performance Networking in Chrome</a>,
browsers make only so many connections to the same combination of scheme,
host and port.</p>
<p>In Chrome this number is 6.  In Firefox this can be tuned up or down by
tweaking the <span class="docutils literal"><span class="pre">network.http.max-persistent-connections-per-server</span></span>
parameter, but the default is 6.</p>
</li>
</ul>
<p>Combining these, it means that after opening about 6 tabs every AJAX call has
to wait up to 50s to be able to even reach the server.</p>
<p>We opted for raising this number in Firefox and to warn users about this.  Our
user base is small enough and the server has yet to achieve any noticeable
load.</p>
</div>
<div class="section" id="epilogue">
<h2>Epilogue</h2>
<p>That&#8217;s what our migration to Odoo story has gone so far.  A little bit
stressful at times, specially when the menus went south for the second time,
but I think we have crossed the yellow line now.  Should anything comes I&#8217;ll
report it.</p>
<p>I&#8217;d love to hear (or read) about others, so I can learn from their experience.</p>
</div>
</div>

    <div class="postmeta">
        
        <div class="categories">
            <span>
                Filed under:
                <a href="../../../categories/management.html">Management</a>, <a href="../../../categories/programming.html">Programming</a></span>
        </div>
        <div class="tags">
            <span>
                Tags:
                <a href="../../../tags/odoo.html">Odoo</a>, <a href="../../../tags/openerp.html">OpenERP</a></span>
        </div>
        </div>
    <div class="timestamp postmeta">
            <span>May 26, 2015</span>
        </div>
    <ul class="related clearfix">
            <li class="left"></li>
            <li class="right"><a href="../../04/08/rememoring-microservices.html">Memento: microservices</a> &raquo; </li>
        </ul></article>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'mvaled-io';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the
      <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><aside class="sidebar"></aside></div> <!-- #main --></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo"><footer class="wrapper"><p>
      &copy; Copyright 2014, 2015, Manuel VÃ¡zquez Acosta. </p>
      <p>Content licensed under the Creative Commons
      attribution-noncommercial-sharealike License.
      </p></footer></div> <!-- footer-container -->

      </div> <!--! end of #container --><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->
    </body>
</html>