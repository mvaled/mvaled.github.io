<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title><manuel> &mdash; Reviewing Odoo 8.0
</title>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="stylesheet" href="/theme/style-202507061303.css">
  </head>
  <body>
    <header class="logo tw:flex tw:flex-row tw:items-center tw:mx-[auto] tw:max-w-[1100px] tw:py-2 tw:px-4 tw:md:px-8 tw:m-0 tw:md:mb-2">
        <h1 class="tw:m-0">
          <a href="/">&lang;m∀&rang;</a>
        </h1>
      <div class="tw:grow"></div>
        <nav>
          <ul class="tw:flex tw:flex-row tw:gap-4 tw:max-w-[90%] tw:list-none">
                <li><a href="/pages/about.html" >About</a></li>
          </ul>
        </nav>
    </header>
    <main class="tw:p-4 tw:md:p-8">
<article>
    <header>
        <h2>Reviewing Odoo&nbsp;8.0</h2>
        <p class="meta">2014-08-28 &bull; Manuel Vázquez Acosta</p>
    </header>
    <p>This is the first of a series of blog posts related to the next OpenERP 8.0
(or should I say Odoo 8.0).  This first post will be very &#8220;seeking for
orientation&#8221; on major new features and changes.  Don&#8217;t expect anything to be
deeply commented or&nbsp;analyzed.</p>
<p>I will probably devote several posts for changes in some modules, but in this
one I&#8217;ll just write about things that can be immediately seen when you first
install&nbsp;it.</p>
<div class="section" id="installing-odoo-8-0">
<h2>Installing Odoo&nbsp;8.0</h2>
<p>I&#8217;m working with a clone from the now official <a class="reference external" href="https://github.com/odoo/odoo">github.com odoo repository</a>.
Of course I&#8217;m using the branch &#8220;8.0&#8221; for this&nbsp;review.</p>
<p>I prepared a <a class="reference external" href="https://pypi.python.org/pypi/virtualenv">virtual environment</a> and installed odoo there like&nbsp;this:</p>
<pre class="literal-block">
$ python setup.py develop
</pre>
<p>The first I noticed is that several new requirements are in place, and the
<cite>pyPdf</cite> requirement had been&nbsp;forgotten.</p>
<p>Second thing noticed is that unlike the &#8220;7.0&#8221; you don&#8217;t need to run the
<tt class="docutils literal"><span class="pre">openerp-server</span></tt> script passing the <tt class="docutils literal"><span class="pre">--addons-path=./addons</span></tt>.  In 8.0 they
include this path automatically.  So running <tt class="docutils literal"><span class="pre">./openerp-server</span></tt> is&nbsp;enough.</p>
<p>Also the <tt class="docutils literal">python setup.py sdist</tt> command includes this path as well, so a
properly built distribution from source seems more doable.  I haven&#8217;t tried
this yet, but I will, cause that was for sure something missing in 7.0.  It&#8217;s
quite suspicious that the tarball is too small (around <span class="caps">13MB</span>)&nbsp;though.</p>
</div>
<div class="section" id="new-addons">
<h2>New&nbsp;addons</h2>
<div class="section" id="instant-messaging">
<h3>Instant&nbsp;Messaging</h3>
<p>Once I ran the server I installed a demo <span class="caps">DB</span> to see what&#8217;s new.  The first
thing that captured my attention was an &#8220;Instant Messaging&#8221; module.  I gave it
a try and it seemed to work&nbsp;out-of-box.</p>
<p>It uses the quite old <a class="reference external" href="http://stackoverflow.com/questions/11077857/what-are-long-polling-websockets-server-sent-events-sse-and-comet">long polling</a> technique instead of the brand new
<a class="reference external" href="http://en.wikipedia.org/wiki/HTML5"><span class="caps">HTML5</span></a>  <a class="reference external" href="http://en.wikipedia.org/wiki/Server-sent_events">Server-Sent Events</a> (<span class="caps">SSE</span>) stuff.&nbsp;Why?</p>
<p>My first guess was that multi-process deployments would need to pass messages
around between the <span class="caps">HTTP</span> processes.  That requires a kind of Inter-Processes
Communication (<span class="caps">IPC</span>).  Popular choices for achieving this in web applications
are <a class="reference external" href="http://redis.io/">Redis</a> and <a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a>, but then you&#8217;d need to setup either for this to&nbsp;work.</p>
<p>After thinking in this a bit more (actually the thinking about this occurred
at the same time I was writing this post) I realized that the <em>current</em>
multi-process deployments would still need this <span class="caps">IPC</span> to properly work.  So I
ran <tt class="docutils literal"><span class="pre">./openerp-server</span> <span class="pre">--workers=2</span></tt> and tested it again.  The chat stopped to
work and the following error was logged from time to&nbsp;time:</p>
<div class="pygment-highlight"><pre><span></span>2014-08-27 22:53:48,972 17858 ERROR o8 openerp.http: Exception during JSON request handling.
Traceback (most recent call last):
  File &quot;/&lt;..&gt;/odoo/openerp/http.py&quot;, line 476, in _handle_exception
    return super(JsonRequest, self)._handle_exception(exception)
  File &quot;/&lt;..&gt;/odoo/openerp/http.py&quot;, line 495, in dispatch
    result = self._call_function(**self.params)
  File &quot;/&lt;..&gt;/odoo/openerp/http.py&quot;, line 311, in _call_function
    return checked_call(self.db, *args, **kwargs)
  File &quot;/&lt;..&gt;/odoo/openerp/service/model.py&quot;, line 113, in wrapper
    return f(dbname, *args, **kwargs)
  File &quot;/&lt;..&gt;/odoo/openerp/http.py&quot;, line 308, in checked_call
    return self.endpoint(*a, **kw)
  File &quot;/&lt;..&gt;/odoo/openerp/http.py&quot;, line 685, in __call__
    return self.method(*args, **kw)
  File &quot;/&lt;..&gt;/odoo/openerp/http.py&quot;, line 360, in response_wrap
    response = f(*args, **kw)
  File &quot;/&lt;..&gt;/odoo/addons/bus/bus.py&quot;, line 188, in poll
    raise Exception(&quot;bus.Bus unavailable&quot;)
Exception: bus.Bus unavailable
</pre></div>
<p>The code explains it all.  This is the method <tt class="docutils literal">ImDispatch.start()</tt> in file
<tt class="docutils literal">addons/bus/bus.py</tt>:</p>
<div class="pygment-highlight"><pre><span></span><span class="pygment-k">def</span> <span class="pygment-nf">start</span><span class="pygment-p">(</span><span class="pygment-bp">self</span><span class="pygment-p">):</span>
    <span class="pygment-k">if</span> <span class="pygment-n">openerp</span><span class="pygment-o">.</span><span class="pygment-n">evented</span><span class="pygment-p">:</span>
        <span class="pygment-c1"># gevent mode</span>
        <span class="pygment-kn">import</span> <span class="pygment-nn">gevent</span>
        <span class="pygment-bp">self</span><span class="pygment-o">.</span><span class="pygment-n">Event</span> <span class="pygment-o">=</span> <span class="pygment-n">gevent</span><span class="pygment-o">.</span><span class="pygment-n">event</span><span class="pygment-o">.</span><span class="pygment-n">Event</span>
        <span class="pygment-n">gevent</span><span class="pygment-o">.</span><span class="pygment-n">spawn</span><span class="pygment-p">(</span><span class="pygment-bp">self</span><span class="pygment-o">.</span><span class="pygment-n">run</span><span class="pygment-p">)</span>
    <span class="pygment-k">elif</span> <span class="pygment-n">openerp</span><span class="pygment-o">.</span><span class="pygment-n">multi_process</span><span class="pygment-p">:</span>
        <span class="pygment-c1"># disabled in prefork mode</span>
        <span class="pygment-k">return</span>
    <span class="pygment-k">else</span><span class="pygment-p">:</span>
        <span class="pygment-c1"># threaded mode</span>
        <span class="pygment-bp">self</span><span class="pygment-o">.</span><span class="pygment-n">Event</span> <span class="pygment-o">=</span> <span class="pygment-n">threading</span><span class="pygment-o">.</span><span class="pygment-n">Event</span>
        <span class="pygment-n">t</span> <span class="pygment-o">=</span> <span class="pygment-n">threading</span><span class="pygment-o">.</span><span class="pygment-n">Thread</span><span class="pygment-p">(</span><span class="pygment-n">name</span><span class="pygment-o">=</span><span class="pygment-s2">&quot;</span><span class="pygment-si">%s</span><span class="pygment-s2">.Bus&quot;</span> <span class="pygment-o">%</span> <span class="pygment-vm">__name__</span><span class="pygment-p">,</span> <span class="pygment-n">target</span><span class="pygment-o">=</span><span class="pygment-bp">self</span><span class="pygment-o">.</span><span class="pygment-n">run</span><span class="pygment-p">)</span>
        <span class="pygment-n">t</span><span class="pygment-o">.</span><span class="pygment-n">daemon</span> <span class="pygment-o">=</span> <span class="pygment-kc">True</span>
        <span class="pygment-n">t</span><span class="pygment-o">.</span><span class="pygment-n">start</span><span class="pygment-p">()</span>
    <span class="pygment-k">return</span> <span class="pygment-bp">self</span>
</pre></div>
<p>The highlighted line says this won&#8217;t work in a multi-process deployment.  How
do you get to use the <cite>evented</cite> mode, I don&#8217;t know.  Probably that&#8217;s the
default&nbsp;now.</p>
<p>So I need to review this feature more closely before going to production.
It&#8217;s a nice addition&nbsp;though.</p>
<p>I found they have now a <a class="reference external" href="https://github.com/odoo/odoo/blob/master/openerp/service/server.py#L321"><tt class="docutils literal">GeventServer</tt></a> for long polling connections.  And the
implementation of the Instant Messaging Bus (<a class="reference external" href="https://github.com/odoo/odoo/blob/master/openerp/addons/bus/bus.py">bus.py</a>) can be easily adapted
for desktop-like notifications, updating your message inbox, and many other
features that would benefit from&nbsp;this.</p>
</div>
<div class="section" id="messaging-has-gone-a-bit-different">
<h3>Messaging has gone a bit&nbsp;different</h3>
<p>At this point I tried to send a message from a user to another (to test if the
inbox was updated real-time) and realized that the Messaging addons has lost
the &#8220;compose a new message&#8221; that was previously accessible from the inbox, let
me show you a picture (7.0 on the right, 8.0 on the&nbsp;left):</p>
<div class="figure">
<img alt="" src="odoo-vs-openerp.png" />
<p class="caption">Odoo is missing the &#8220;Compose new message&#8221;&nbsp;button.</p>
</div>
<p>This commit has some&nbsp;explanation:</p>
<pre class="literal-block">
commit 0714b231646bb439b121a6aaa43df32fedcb5e6e
Author: Thibault Delavallée &lt;tde&#64;openerp.com&gt;
Date:   Wed Aug 13 14:35:25 2014 +0200

[FIX] mail: when having only mail installed, do not show any 'share with my
followers' compose box. This comes only with hr, for the inbox. This was
probably forgotten when updating the mailboxes hr-goal and hr-related
gamification / chatter stuff.
</pre>
<p>I then installed the &#8220;Employee directory&#8221; addon and the &#8220;Share with my
followers&#8221; box&nbsp;appeared.</p>
<p>More digging in the logs reveals the&nbsp;following:</p>
<pre class="literal-block">
commit e6f8666b521fe8c2522d6e94c0c3def54a5f73ed
Merge: d57a97d bf3d4a7
Author: Amit Vora &lt;avo&#64;tinyerp.com&gt;
Date:   Thu Apr 17 11:41:33 2014 +0200

[MERGE] [IMP] mail: Inbox usability improvements :
- notficiation_email_send field, renamed into notify_email, has now 2 values: always or never, in
order to ease the choice and simplify options.
- inbox: removed 'compose a new messages or write to my followers', because those 2 options are
already available. The first one is accessible using the top-right email icon, the second one
is accessible with the 'write to my followers' text box alread present in the inbox.
</pre>
<p>However I don&#8217;t see the mentioned &#8220;top-right email icon&#8221;.  In fact, that icon
is present in 7.0, but not in 8.0.  More&nbsp;digging:</p>
<pre class="literal-block">
commit 5209fbc7ed9fcad966ab064654a8a8697142be42
Author: Antony Lesuisse &lt;al&#64;openerp.com&gt;
Date:   Mon Jun 30 01:51:40 2014 +0200

[REM] useless icon send a message

The action is available from the wall.
</pre>
<p>Got you!  So, Antony removed the icon cause he thought it was the wall, but
Amit had removed it from the wall cause because of the icon.  These things&nbsp;happen&#8230;</p>
<p>After reverting this commit, the icon is reestablished.  But, then I realized
that the feature, however hidden, is actually there: If you click on the
&#8220;Share with &#8230;&#8221; and instead of writing your message there, click on the
&#8220;expand&#8221; icon, then you get the same as pressing the (now missing) email icon.
I think that the icon is required, though, since now the &#8220;Share&#8230;&#8221; box is not
shown until <span class="caps">HR</span> is installed, and the email icon allows to send email to
outsiders.  My current employer is willing to remove email in favor of this
messaging module.  This may hold him&nbsp;back.</p>
<p>I&#8217;m <a class="reference external" href="https://github.com/odoo/odoo/issues/2042">raising my hand to vote</a> for the rescue of (at least) the icon.
Redundancy is not always bad when it comes to user&nbsp;interface.</p>
<p>This enough for this post.  I&#8217;ll keep looking at Odoo and I&#8217;ll write about&nbsp;it.</p>
<!-- Local Variables:
ispell-dictionary: "en"
End: -->
</div>
</div>

</article>
    </main>
    <footer>
      <p>&copy; 2016-2025 Manuel Vázquez Acosta</p>
      <p>Content licensed under the Creative Commons
        attribution-noncommercial-sharealike License.</p>
    </footer>
  </body>
</html>

